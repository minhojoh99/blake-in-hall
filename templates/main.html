<!DOCTYPE html>
<html lang="en">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<head>
    <meta charset="UTF-8">
    <title>블레인크홀 이미지 검색 시스템</title>
</head>
<br>
<body>



<div class="container">
    <h3>블레인크홀 이미지 검색 시스템</h3>

    <button class="btn btn-primary" onclick="location.href='/db_connect'">DB 연결</button>

<!--    <form class="form-inline form-control form-control-lg" method="POST" action="{{ url_for('catUpdate') }}"> 카테고리 선택-->
      <select name="category1" id="cat1" onchange="select1()">
        <option value="none">=== 상품분류 ===</option>
        {% for cat in big_categories %}
            <option value="{{cat}}">{{cat}}</option>
        {% endfor %}
      </select>
      <select name="category2" id="cat2" onchange="select2()">
        <option value="none">=== 카테고리 ===</option>
        {% for cat in mid_categories %}
            <option value={{cat}}">{{cat}}</option>
        {% endfor %}
      </select>
      <select name="category3" id="cat3" onchange="select3()">
        <option value="none">=== 아이템 ===</option>
        {% for cat in items %}
            <option value={{cat}}">{{cat}}</option>
        {% endfor %}
      </select>
      <select name="category4" id="cat4" onchange="select4()">
        <option value="none">=== 색상 ===</option>
        {% for cat in colors %}
            <option value={{cat}}">{{cat}}</option>
        {% endfor %}
      </select>
<!--      <button type="submit" class="col btn btn-lg btn-warning">완료</button>-->
<!--    </form>-->
</div>
<div>
    <h2 id="bigcat"></h2>
    <h2 id="midcat"></h2>
    <h2 id="item"></h2>
</div>

<br>
<div class="container">
    <div class="row">
        <button class="btn btn-success btn-lg" onclick="location.href='/model_ready'">이미지 분석 모델 로드</button>
    </div>
</div>
<br>

<div class="container">

    <hr width = "90%" color = "red">
    <form method="POST" action="/inference1" enctype="multipart/form-data">
        <div>
            <label for="이미지태그_테스트"> 이미지파일 </label>
            <input type = "file" class="form-control form-control-md" name = "file"/>
        </div>
        <button class="btn btn-primary btn-lg btn-block" type="submit"> 유사 이미지 검색 </button>
    </form>
</div>


</body>

</html>

<script>
    function select1(){
        var numSelect = document.getElementById("cat1");

        // text 가져오기

        var text = numSelect.options[document.getElementById("cat1").selectedIndex].text;
        // option value 가져오기

        var value = numSelect.options[document.getElementById("cat1").selectedIndex].value;

        $.ajax({
          type : 'POST',
          url : '{{url_for("catUpdate1")}}',
          data : JSON.stringify({'text':text, 'value':value}),
          dataType : 'JSON',
          contentType: "application/json",
          success : function(res) {
<!--            alert("result = "+ res.result + " " + res.mid_categories);-->
            window.location.href = "{{ url_for('catUpdate') }}";
            var bigcat = document.getElementById("bigcat");
            bigcat.innerText = value;
          },
          error : function(request, status, error) {
            alert('요청 실패... ' + error);
          }
        })
    }

        function select2(){
        var numSelect = document.getElementById("cat2");

        // text 가져오기

        var text = numSelect.options[document.getElementById("cat2").selectedIndex].text;
        // option value 가져오기

        var value = numSelect.options[document.getElementById("cat2").selectedIndex].value;

        $.ajax({
          type : 'POST',
          url : '{{url_for("catUpdate2")}}',
          data : JSON.stringify({'text':text, 'value':value}),
          dataType : 'JSON',
          contentType: "application/json",
          success : function(res) {
<!--            alert("result = "+ res.result + " " + res.items);-->
            window.location.href = "{{ url_for('catUpdate') }}";
            var midcat = document.getElementById("midcat");
            midcat.innerText = value;
          },
          error : function(request, status, error) {
            alert('요청 실패... ' + error);
          }
        })
    }

    function select3(){
        var numSelect = document.getElementById("cat3");

        // text 가져오기

        var text = numSelect.options[document.getElementById("cat3").selectedIndex].text;
        // option value 가져오기

        var value = numSelect.options[document.getElementById("cat3").selectedIndex].value;

        $.ajax({
          type : 'POST',
          url : '{{url_for("catUpdate3")}}',
          data : JSON.stringify({'text':text, 'value':value}),
          dataType : 'JSON',
          contentType: "application/json",
          success : function(res) {
<!--            alert("result = "+ res.result);-->
            window.location.href = "{{ url_for('catUpdate') }}";
            var item = document.getElementById("item");
            item.innerText = value;
          },
          error : function(request, status, error) {
            alert('요청 실패... ' + error);
          }
        })
    }

    function select4(){
        var numSelect = document.getElementById("cat4");

        // text 가져오기

        var text = numSelect.options[document.getElementById("cat4").selectedIndex].text;
        // option value 가져오기

        var value = numSelect.options[document.getElementById("cat4").selectedIndex].value;

        $.ajax({
          type : 'POST',
          url : '{{url_for("catUpdate4")}}',
          data : JSON.stringify({'text':text, 'value':value}),
          dataType : 'JSON',
          contentType: "application/json",
          success : function(res) {
<!--            alert("result = "+ res.result);-->
            window.location.href = "{{ url_for('catUpdate') }}";
            var item = document.getElementById("item");
            item.innerText = value;
          },
          error : function(request, status, error) {
            alert('요청 실패... ' + error);
          }
        })
    }
</script>